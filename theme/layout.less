@import 'common.less';

:root {
  //* default colors
  --color-h: var(--base-h);
  --color-s: var(--base-s);
  --color-l: var(--base-l);
  --color-a: var(--base-a);

  --color-img: var(--base-img);
  --color-img-overlay: var(--base-img-overlay);
  --color-img-blend: var(--base-img-blend);
  --color-imp-size: var(--base-imp-size);
  --color-img-pos: var(--base-img-pos);
  --color-img-attachment: var(--base-img-attachment);

  --bg: var(--base-bg);
  --text: var(--base-text);
  --link: var(--base-link);
  --heading: var(--base-heading);
  --strongheading: var(--base-strongheading);
  --shadow: var(--base-shadow);
  --textshadow: var(--base-shadow);

  --color-fg-h: var(--base-fg-h);
  --color-fg-s: var(--base-fg-s);
  --color-fg-l: var(--base-fg-l);
  --color-fg-a: var(--base-fg-a);
  --color-fg-text: var(--base-fg-text);

  --font: var(--base-font);
}

html, body {
  font-family: var(--font);
  font-size: var(--font-size);
  line-height: var(--line-height);
  text-shadow: 2px 2px var(--textshadow-size) var(--textshadow);

  width: 100%;
  min-height: 100vh;
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  background-color: hsl(var(--color-h), var(--color-s), var(--color-l));
  //todo: detect if overlay exists
  background-image: var(--color-img) var(--color-img-overlay);
  color: var(--text);

  background-blend-mode: var(--color-img-blend);
  background-size: var(--color-imp-size);
  background-position: var(--color-img-pos);
  background-attachment: fixed;
  background-repeat: no-repeat;

  overflow-x: hidden;
  overflow-y: auto;
  overflow-y: overlay;
}

body {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
}

main {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  padding-block: var(--page-padding-inline, 1rem);
  box-shadow: 0 0 var(--shadow-size) var(--shadow);
  z-index: 100;

  flex: 1;

  &.page-bg, &.card-bg {
    border-radius: var(--border-radius);
    margin-block: 40px;

    @media (max-width: @desktop-width) {
      border-radius: 0;
      margin-block: 0;
    }
  }
}

#page-content {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  flex: 1;
  z-index: 100;

  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: stretch;
  gap: 1rem;

  box-shadow: 0 0 var(--shadow-size) var(--shadow);

  main {
    box-shadow: none;

    &.page-bg, &.card-bg {
      box-shadow: 0 0 var(--shadow-size) var(--shadow);
    }
  }

  .widget, .sidebar {
    width: var(--widget-size);
    max-width: var(--widget-max-size);
    margin: 0;
    padding: var(--page-padding-inline, 1rem);
    box-sizing: border-box;
    z-index: 50;

    & > :last-child.widget-smaller-than-vh {
      position: sticky;
      top: calc(var(--page-padding-inline, 1rem) + var(--header-height, 0.001px));
    }

    &.page-bg, &.card-bg {
      border-radius: var(--border-radius);
      margin-block: 40px;

      &:first-child {
        border-radius: 0 var(--border-radius) var(--border-radius) 0;
      }

      &:last-child {
        border-radius: var(--border-radius) 0 0 var(--border-radius);
      }
    }

    @media (max-width: @desktop-width) {
      display: none;
    }
  }
}


//* Content Grid
.content-grid, .full-width {
  --padding-inline: var(--page-padding-inline, 1rem);
  --content-max-width: var(--page-content-max-width, 120ch);
  --breakout-max-width: var(--page-breakout-max-width, calc(var(--content-max-width) + 15ch));

  --breakout-size: calc((var(--breakout-max-width) - var(--content-max-width)) / 2);

  display: grid;
  grid-template-columns:
    [full-width-start] minmax(var(--padding-inline), 1fr)
    [breakout-start] minmax(0, var(--breakout-size))
    [content-start] min(calc(100% - (var(--padding-inline) * 2)), var(--content-max-width)) [content-end]
    // [content-start] 120ch [content-end]
    minmax(0, var(--breakout-size)) [breakout-end]
    minmax(var(--padding-inline), 1fr) [full-width-end];
  grid-auto-rows: max-content;

  box-sizing: border-box;

  @media (min-width: @mobile-width) {
    --padding-inline: var(--page-padding-inline-desktop);
  }

  & > :not(.breakout, .full-width) {
    grid-column: content;
    border-radius: var(--border-radius);
  }

  & > .breakout {
    grid-column: breakout;

    border-radius: var(--border-radius);
  }

  & > .breakout-bg {
    grid-column: breakout;

    padding: var(--padding-inline);
    border-radius: var(--border-radius);
  }

  & > .full-width {
    grid-column: full-width;

    display: grid;
    grid-template-columns: inherit;

    padding: var(--padding-inline);
  }

  & > .full-text {
    grid-column: full-width;

    padding: var(--padding-inline);
  }

  &.page-bg, &.card-bg & > .page-bg {
    width: 100%;
    max-width: var(--page-hard-max-width, 100%);
    margin-inline: auto;

    box-shadow: 0 0 var(--shadow-size) var(--shadow);
  }
}
